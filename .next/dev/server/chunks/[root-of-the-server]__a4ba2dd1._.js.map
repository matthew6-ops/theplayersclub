{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/matthelfer/Documents/theplayersclub/lib/oddsCache.ts"],"sourcesContent":["// lib/oddsCache.ts\n\nexport type OddsApiResponse = unknown\n\ntype CacheEntry = {\n  data: OddsApiResponse\n  updatedAt: number\n}\n\nconst CACHE_TTL_MS = 15_000 // 15 seconds – tweak as needed\n\nconst cache = new Map<string, CacheEntry>()\n\nexport function getCachedOdds(key: string) {\n  const entry = cache.get(key)\n  if (!entry) return null\n\n  const ageMs = Date.now() - entry.updatedAt\n  if (ageMs > CACHE_TTL_MS) {\n    return null\n  }\n\n  return { data: entry.data, ageMs }\n}\n\nexport function setCachedOdds(key: string, data: OddsApiResponse) {\n  cache.set(key, {\n    data,\n    updatedAt: Date.now()\n  })\n}\n\nexport function getCacheTtlMs() {\n  return CACHE_TTL_MS\n}\n"],"names":[],"mappings":"AAAA,mBAAmB;;;;;;;;;AASnB,MAAM,eAAe,OAAO,+BAA+B;;AAE3D,MAAM,QAAQ,IAAI;AAEX,SAAS,cAAc,GAAW;IACvC,MAAM,QAAQ,MAAM,GAAG,CAAC;IACxB,IAAI,CAAC,OAAO,OAAO;IAEnB,MAAM,QAAQ,KAAK,GAAG,KAAK,MAAM,SAAS;IAC1C,IAAI,QAAQ,cAAc;QACxB,OAAO;IACT;IAEA,OAAO;QAAE,MAAM,MAAM,IAAI;QAAE;IAAM;AACnC;AAEO,SAAS,cAAc,GAAW,EAAE,IAAqB;IAC9D,MAAM,GAAG,CAAC,KAAK;QACb;QACA,WAAW,KAAK,GAAG;IACrB;AACF;AAEO,SAAS;IACd,OAAO;AACT"}},
    {"offset": {"line": 83, "column": 0}, "map": {"version":3,"sources":["file:///Users/matthelfer/Documents/theplayersclub/app/api/odds/route.ts"],"sourcesContent":["// app/api/odds/route.ts\nimport { NextResponse } from \"next/server\"\nimport {\n  getCachedOdds,\n  setCachedOdds,\n  getCacheTtlMs\n} from \"../../../lib/oddsCache\"\n\n// Map friendly UI sport codes → Odds API sport keys\nconst SPORT_MAP: Record<string, string> = {\n  nba: \"basketball_nba\",\n  nfl: \"americanfootball_nfl\",\n  nhl: \"icehockey_nhl\",\n}\n\nexport async function GET(req: Request) {\n  const { searchParams } = new URL(req.url)\n\n  const sport = searchParams.get(\"sport\")\n  const marketsParam = searchParams.get(\"markets\") ?? \"h2h,spreads,totals\"\n  const force = searchParams.get(\"force\") === \"1\"\n\n  if (!sport) {\n    return NextResponse.json(\n      { error: \"SPORT_MISSING\" },\n      { status: 400 }\n    )\n  }\n\n  const apiSport = SPORT_MAP[sport] ?? sport // fallback if we ever pass full ID\n\n  const apiKey = process.env.ODDS_API_KEY\n  if (!apiKey) {\n    return NextResponse.json(\n      { error: \"ODDS_API_KEY_MISSING\" },\n      { status: 500 }\n    )\n  }\n\n  const cacheKey = `${apiSport}|${marketsParam}`\n\n  // 1) Try cache first (unless force refresh)\n  if (!force) {\n    const cached = getCachedOdds(cacheKey)\n    if (cached) {\n      const cachedPayload: any = cached.data\n      const oddsFromCache = Array.isArray(cachedPayload?.odds)\n        ? cachedPayload.odds\n        : cachedPayload\n      return NextResponse.json({\n        ok: true,\n        source: \"cache\",\n        sport: apiSport,\n        markets: marketsParam.split(\",\"),\n        ageMs: cached.ageMs,\n        ttlMs: getCacheTtlMs(),\n        odds: oddsFromCache,\n      })\n    }\n  }\n\n  // 2) Cache miss or force refresh → call The Odds API\n  const url = new URL(\n    `https://api.the-odds-api.com/v4/sports/${apiSport}/odds`\n  )\n\n  url.searchParams.set(\"apiKey\", apiKey)\n  url.searchParams.set(\"regions\", \"us\")\n  url.searchParams.set(\"markets\", marketsParam)\n  url.searchParams.set(\"oddsFormat\", \"decimal\")\n  url.searchParams.set(\"bookmakers\", \"fanduel,draftkings,betmgm,caesars\")\n\n  const upstreamRes = await fetch(url.toString(), {\n    cache: \"no-store\",\n  })\n\n  if (!upstreamRes.ok) {\n    const text = await upstreamRes.text()\n    return NextResponse.json(\n      {\n        error: \"ODDS_API_REQUEST_FAILED\",\n        status: upstreamRes.status,\n        body: text,\n      },\n      { status: 500 }\n    )\n  }\n\n  const oddsJson = await upstreamRes.json()\n\n  // Also pull real-time scoreboard data for current sport so we can\n  // show game status (quarter, clock, etc.) alongside the odds list.\n  let scoreboardJson: any[] = []\n  try {\n    const scoreboardUrl = new URL(\n      `https://api.the-odds-api.com/v4/sports/${apiSport}/scores`\n    )\n    scoreboardUrl.searchParams.set(\"apiKey\", apiKey)\n    scoreboardUrl.searchParams.set(\"daysFrom\", \"2\")\n\n    const scoreboardRes = await fetch(scoreboardUrl.toString(), {\n      cache: \"no-store\",\n    })\n\n    if (scoreboardRes.ok) {\n      scoreboardJson = await scoreboardRes.json()\n    }\n  } catch (err) {\n    console.error(\"Failed to load scoreboard data\", err)\n  }\n\n  const scoreboardMap = new Map<string, any>()\n  scoreboardJson.forEach((game: any) => {\n    if (!game) return\n    const key = game.id ?? `${game.home_team}|${game.away_team}`\n    if (key) {\n      scoreboardMap.set(key, game)\n    }\n  })\n\n  const oddsWithScoreboard = oddsJson.map((game: any) => {\n    const scoreboard =\n      scoreboardMap.get(game.id) ??\n      scoreboardMap.get(`${game.home_team}|${game.away_team}`)\n\n    return {\n      ...game,\n      scoreboard,\n    }\n  })\n\n  // 3) Save to cache\n  setCachedOdds(cacheKey, {\n    odds: oddsWithScoreboard,\n  })\n\n  return NextResponse.json({\n    ok: true,\n    source: \"live\",\n    sport: apiSport,\n    markets: marketsParam.split(\",\"),\n    ageMs: 0,\n    ttlMs: getCacheTtlMs(),\n    odds: oddsWithScoreboard,\n  })\n}\n"],"names":[],"mappings":"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"}}]
}