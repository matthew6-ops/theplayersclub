{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/matthelfer/Documents/theplayersclub/lib/arbitrage.ts"],"sourcesContent":["export function detectArbitrageWithStakes(best: Record<string, number>) {\n  const teams = Object.keys(best);\n  if (teams.length !== 2) return null;\n\n  const [t1, t2] = teams;\n  const o1 = best[t1];\n  const o2 = best[t2];\n\n  const imp1 = 1 / o1;\n  const imp2 = 1 / o2;\n\n  const sumImp = imp1 + imp2;\n\n  if (sumImp >= 1) return { exists: false };\n\n  const profitPercent = (1 - sumImp) * 100;\n\n  function stake(total: number) {\n    const s1 = (total * imp1) / sumImp;\n    const s2 = (total * imp2) / sumImp;\n    return {\n      stake1: s1,\n      stake2: s2,\n      guaranteedProfit: total - (s1 + s2)\n    };\n  }\n\n  return {\n    exists: true,\n    profitPercent,\n    stakeCalc: stake,\n    teams: [t1, t2]\n  };\n}\n\nexport default async function getOpportunities() {\n  const API_KEY = process.env.ODDS_API_KEY;\n  if (!API_KEY) {\n    console.error(\"Missing ODDS_API_KEY\");\n    return [];\n  }\n\n  const url = `https://api.the-odds-api.com/v4/sports/basketball_nba/odds?apiKey=${API_KEY}&regions=us&markets=h2h&oddsFormat=decimal`;\n\n  const res = await fetch(url, {\n    next: { revalidate: 10 }\n  });\n\n  if (!res.ok) {\n    console.error(\"Error fetching odds:\", res.status);\n    return [];\n  }\n\n  const data = await res.json();\n\n  const games = data.map((game: any) => {\n    const bookmakers = game.bookmakers ?? [];\n\n    const best: Record<string, number> = {};\n\n    bookmakers.forEach((bm: any) => {\n      bm.markets?.forEach((m: any) => {\n        if (m.key !== \"h2h\") return;\n\n        m.outcomes?.forEach((o: any) => {\n          if (!best[o.name] || o.price > best[o.name]) {\n            best[o.name] = o.price;\n          }\n        });\n      });\n    });\n\n    const arb = detectArbitrageWithStakes(best);\n\n    return {\n      id: game.id,\n      sport_key: game.sport_key,\n      sport_title: game.sport_title,\n      home_team: game.home_team,\n      away_team: game.away_team,\n      commence_time: game.commence_time,\n      bookmakers,\n      best,\n      arb\n    };\n  });\n\n  return games;\n}\n\nexport { getOpportunities };\n"],"names":[],"mappings":";;;;;;;;AAAO,SAAS,0BAA0B,IAA4B;IACpE,MAAM,QAAQ,OAAO,IAAI,CAAC;IAC1B,IAAI,MAAM,MAAM,KAAK,GAAG,OAAO;IAE/B,MAAM,CAAC,IAAI,GAAG,GAAG;IACjB,MAAM,KAAK,IAAI,CAAC,GAAG;IACnB,MAAM,KAAK,IAAI,CAAC,GAAG;IAEnB,MAAM,OAAO,IAAI;IACjB,MAAM,OAAO,IAAI;IAEjB,MAAM,SAAS,OAAO;IAEtB,IAAI,UAAU,GAAG,OAAO;QAAE,QAAQ;IAAM;IAExC,MAAM,gBAAgB,CAAC,IAAI,MAAM,IAAI;IAErC,SAAS,MAAM,KAAa;QAC1B,MAAM,KAAK,AAAC,QAAQ,OAAQ;QAC5B,MAAM,KAAK,AAAC,QAAQ,OAAQ;QAC5B,OAAO;YACL,QAAQ;YACR,QAAQ;YACR,kBAAkB,QAAQ,CAAC,KAAK,EAAE;QACpC;IACF;IAEA,OAAO;QACL,QAAQ;QACR;QACA,WAAW;QACX,OAAO;YAAC;YAAI;SAAG;IACjB;AACF;AAEe,eAAe;IAC5B,MAAM,UAAU,QAAQ,GAAG,CAAC,YAAY;IACxC,IAAI,CAAC,SAAS;QACZ,QAAQ,KAAK,CAAC;QACd,OAAO,EAAE;IACX;IAEA,MAAM,MAAM,CAAC,kEAAkE,EAAE,QAAQ,0CAA0C,CAAC;IAEpI,MAAM,MAAM,MAAM,MAAM,KAAK;QAC3B,MAAM;YAAE,YAAY;QAAG;IACzB;IAEA,IAAI,CAAC,IAAI,EAAE,EAAE;QACX,QAAQ,KAAK,CAAC,wBAAwB,IAAI,MAAM;QAChD,OAAO,EAAE;IACX;IAEA,MAAM,OAAO,MAAM,IAAI,IAAI;IAE3B,MAAM,QAAQ,KAAK,GAAG,CAAC,CAAC;QACtB,MAAM,aAAa,KAAK,UAAU,IAAI,EAAE;QAExC,MAAM,OAA+B,CAAC;QAEtC,WAAW,OAAO,CAAC,CAAC;YAClB,GAAG,OAAO,EAAE,QAAQ,CAAC;gBACnB,IAAI,EAAE,GAAG,KAAK,OAAO;gBAErB,EAAE,QAAQ,EAAE,QAAQ,CAAC;oBACnB,IAAI,CAAC,IAAI,CAAC,EAAE,IAAI,CAAC,IAAI,EAAE,KAAK,GAAG,IAAI,CAAC,EAAE,IAAI,CAAC,EAAE;wBAC3C,IAAI,CAAC,EAAE,IAAI,CAAC,GAAG,EAAE,KAAK;oBACxB;gBACF;YACF;QACF;QAEA,MAAM,MAAM,0BAA0B;QAEtC,OAAO;YACL,IAAI,KAAK,EAAE;YACX,WAAW,KAAK,SAAS;YACzB,aAAa,KAAK,WAAW;YAC7B,WAAW,KAAK,SAAS;YACzB,WAAW,KAAK,SAAS;YACzB,eAAe,KAAK,aAAa;YACjC;YACA;YACA;QACF;IACF;IAEA,OAAO;AACT"}},
    {"offset": {"line": 136, "column": 0}, "map": {"version":3,"sources":["file:///Users/matthelfer/Documents/theplayersclub/app/api/opportunities/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport { getOpportunities } from \"@/lib/arbitrage\";\n\nexport async function GET() {\n  try {\n    const data = await getOpportunities();\n    return NextResponse.json(data);\n  } catch (err) {\n    console.error(\"API /opportunities error:\", err);\n    return NextResponse.json(\n      { error: \"Failed to load opportunities\" },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe;IACpB,IAAI;QACF,MAAM,OAAO,MAAM,IAAA,sIAAgB;QACnC,OAAO,gJAAY,CAAC,IAAI,CAAC;IAC3B,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,6BAA6B;QAC3C,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAA+B,GACxC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}